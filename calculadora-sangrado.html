<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Riesgo de Sangrado Endoscópico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .result-card {
            transition: all 0.3s ease-in-out;
        }
        .risk-low {
            background-color: #dcfce7; /* green-100 */
            border-left-color: #22c55e; /* green-500 */
        }
        .risk-intermediate {
            background-color: #fef9c3; /* yellow-100 */
            border-left-color: #f59e0b; /* yellow-500 */
        }
        .risk-high {
            background-color: #fee2e2; /* red-100 */
            border-left-color: #ef4444; /* red-500 */
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <header class="text-center mb-8 no-print">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Calculadora de Riesgo de Sangrado Post-Endoscopia</h1>
            <p class="mt-2 text-lg text-gray-600">Evalúe el riesgo de sangrado de un paciente antes de un procedimiento endoscópico.</p>
        </header>

        <main id="print-area" class="bg-white p-6 md:p-8 rounded-2xl shadow-lg">
            <div id="calculator-form" class="grid grid-cols-1 md:grid-cols-2 gap-8">

                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2">Factores del Paciente</h2>
                    
                    <div>
                        <label for="antithrombotic" class="block text-md font-medium text-gray-700 mb-2">Terapia Antitrombótica</label>
                        <select id="antithrombotic" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 no-print">
                            <option value="0">Ninguna</option>
                            <option value="1">Aspirina / AINE</option>
                            <option value="2">Inhibidor P2Y12 (Clopidogrel, etc.)</option>
                            <option value="3">Doble Antiagregación (DAPT)</option>
                            <option value="3">Anticoagulante (Warfarina, ACOD)</option>
                        </select>
                        <p id="antithrombotic-print" class="text-gray-900 text-lg font-medium hidden print:block"></p>
                    </div>

                    <div>
                        <h3 class="text-md font-medium text-gray-700 mb-2">Comorbilidades</h3>
                        <div class="space-y-2" id="comorbidities-selection">
                            <div class="flex items-center">
                                <input type="checkbox" id="renal_failure" value="2" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 no-print">
                                <label for="renal_failure" class="ml-3 text-gray-700">Insuficiencia Renal Crónica (FG < 60)</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="liver_disease" value="1" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 no-print">
                                <label for="liver_disease" class="ml-3 text-gray-700">Enfermedad Hepática Crónica</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="thrombocytopenia" value="2" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 no-print">
                                <label for="thrombocytopenia" class="ml-3 text-gray-700">Trombocitopenia (Plaquetas < 100,000)</label>
                            </div>
                             <div class="flex items-center">
                                <input type="checkbox" id="age" value="1" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 no-print">
                                <label for="age" class="ml-3 text-gray-700">Edad > 70 años</label>
                            </div>
                        </div>
                        <ul id="comorbidities-print" class="list-disc list-inside text-gray-900 text-lg font-medium hidden print:block"></ul>
                    </div>
                </div>

                <div class="space-y-6">
                    <h2 class="text-2xl font-semibold text-gray-800 border-b pb-2">Factores del Procedimiento</h2>
                    <p class="text-sm text-gray-500 no-print">Seleccione el procedimiento de mayor riesgo planeado.</p>
                    
                    <div class="space-y-2" id="procedure-selection">
                        <div class="flex items-center">
                            <input type="radio" id="proc_low" name="procedure" value="0" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 no-print" checked>
                            <label for="proc_low" class="ml-3 text-gray-700">Diagnóstico / Biopsias</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="proc_polypectomy_small" name="procedure" value="1" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 no-print">
                            <label for="proc_polypectomy_small" class="ml-3 text-gray-700">Polipectomía &lt; 1 cm</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="proc_polypectomy_large" name="procedure" value="2" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 no-print">
                            <label for="proc_polypectomy_large" class="ml-3 text-gray-700">Polipectomía ≥ 1 cm</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="proc_sphincterotomy" name="procedure" value="2" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 no-print">
                            <label for="proc_sphincterotomy" class="ml-3 text-gray-700">Esfinterotomía</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="proc_emr" name="procedure" value="3" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 no-print">
                            <label for="proc_emr" class="ml-3 text-gray-700">Resección Mucosa Endoscópica (RME)</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="proc_esd" name="procedure" value="4" class="h-5 w-5 text-blue-600 border-gray-300 focus:ring-blue-500 no-print">
                            <label for="proc_esd" class="ml-3 text-gray-700">Disección Submucosa Endoscópica (DSE)</label>
                        </div>
                    </div>
                     <p id="procedure-print" class="text-gray-900 text-lg font-medium hidden print:block"></p>
                </div>
            </div>

            <div class="mt-10 text-center space-x-4 no-print">
                <button id="calculate-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-transform transform hover:scale-105">
                    Calcular Riesgo
                </button>
                <button id="print-btn" class="bg-gray-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-300 transition-transform transform hover:scale-105 hidden">
                    Imprimir / Guardar PDF
                </button>
            </div>

            <div id="result-section" class="mt-10 hidden">
                <hr class="my-6 no-print"/>
                <div id="result-card" class="result-card border-l-4 p-6 rounded-lg shadow-md">
                    <h3 class="text-2xl font-bold" id="result-title"></h3>
                    <p class="text-lg mt-2">Puntuación Total: <span id="total-score" class="font-bold"></span></p>
                    <p class="mt-4 text-gray-700" id="result-interpretation"></p>
                </div>
            </div>

            <footer class="mt-12 text-center no-print">
                <p class="text-xs text-gray-500">
                    <strong>Aviso:</strong> Esta calculadora es una herramienta de apoyo y no reemplaza el juicio clínico profesional. Los factores de riesgo y la puntuación son un modelo de ejemplo y deben ser validados y adaptados según las guías clínicas locales e internacionales.
                </p>
            </footer>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const calculateBtn = document.getElementById('calculate-btn');
            const printBtn = document.getElementById('print-btn');
            
            const resultSection = document.getElementById('result-section');
            const resultCard = document.getElementById('result-card');
            const resultTitle = document.getElementById('result-title');
            const totalScoreEl = document.getElementById('total-score');
            const resultInterpretation = document.getElementById('result-interpretation');

            const antithromboticPrint = document.getElementById('antithrombotic-print');
            const comorbiditiesPrint = document.getElementById('comorbidities-print');
            const procedurePrint = document.getElementById('procedure-print');

            calculateBtn.addEventListener('click', function () {
                let score = 0;
                
                // Clear previous print-only values
                antithromboticPrint.textContent = '';
                comorbiditiesPrint.innerHTML = '';
                procedurePrint.textContent = '';

                // 1. Calculate score from patient factors
                const antithromboticSelect = document.getElementById('antithrombotic');
                score += parseInt(antithromboticSelect.value, 10);
                antithromboticPrint.textContent = 'Terapia Antitrombótica: ' + antithromboticSelect.options[antithromboticSelect.selectedIndex].text;


                const comorbiditiesCheckboxes = document.querySelectorAll('#comorbidities-selection input[type="checkbox"]:checked');
                if (comorbiditiesCheckboxes.length > 0) {
                     comorbiditiesPrint.innerHTML = 'Comorbilidades:';
                }
                comorbiditiesCheckboxes.forEach(checkbox => {
                    score += parseInt(checkbox.value, 10);
                    const label = document.querySelector(`label[for="${checkbox.id}"]`).textContent;
                    const li = document.createElement('li');
                    li.textContent = label;
                    comorbiditiesPrint.appendChild(li);
                });

                // 2. Calculate score from procedure factors
                const procedureRadio = document.querySelector('#procedure-selection input[name="procedure"]:checked');
                if (procedureRadio) {
                    score += parseInt(procedureRadio.value, 10);
                    const label = document.querySelector(`label[for="${procedureRadio.id}"]`).textContent;
                    procedurePrint.textContent = 'Procedimiento: ' + label;
                }

                // 3. Determine risk level and display result
                totalScoreEl.textContent = score;
                let riskLevel = '';
                let riskClass = '';
                let interpretationText = '';

                if (score <= 2) {
                    riskLevel = 'Riesgo Bajo';
                    riskClass = 'risk-low';
                    interpretationText = 'El riesgo de sangrado post-procedimiento es bajo. Generalmente, no se requieren medidas hemostáticas profilácticas adicionales. Manejar la terapia antitrombótica según guías estándar para procedimientos de bajo riesgo.';
                } else if (score >= 3 && score <= 4) {
                    riskLevel = 'Riesgo Intermedio';
                    riskClass = 'risk-intermediate';
                    interpretationText = 'El riesgo de sangrado es intermedio. Considere el uso de técnicas hemostáticas profilácticas (p. ej., clips, inyección de adrenalina) si se realiza un procedimiento de alto riesgo. Evaluar cuidadosamente el manejo peri-procedimiento de la terapia antitrombótica.';
                } else { // score >= 5
                    riskLevel = 'Riesgo Alto';
                    riskClass = 'risk-high';
                    interpretationText = 'El riesgo de sangrado es alto. Se recomienda fuertemente el uso de hemostasia profiláctica. La terapia antitrombótica debe ser manejada por un equipo multidisciplinario. Considere realizar el procedimiento en un entorno con acceso a cuidados intensivos y banco de sangre.';
                }

                resultTitle.textContent = riskLevel;
                resultInterpretation.textContent = interpretationText;
                
                resultCard.className = 'result-card border-l-4 p-6 rounded-lg shadow-md';
                resultCard.classList.add(riskClass);

                resultSection.classList.remove('hidden');
                printBtn.classList.remove('hidden');
                
                resultSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });

            printBtn.addEventListener('click', function() {
                window.print();
            });
        });
    </script>
    <footer class="text-center mt-12 py-6 border-t border-gray-200 text-xs text-gray-500">
    Creado por Jean C. Pinto-Angarita y David A. Hernandez-Paez
    </footer>
</body>
</html>
